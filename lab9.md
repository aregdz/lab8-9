## Лабораторная работа №09: Репликация и отказоустойчивость
## Цель работы: Освоить настройку и управление физической и логической репликацией в PostgreSQL. Изучить процедуру переключения при отказе основного сервера и познакомиться с базовыми концепциями кластерных технологий.
**Дата:** 2025-12-4
**Семестр:** 4 курс 1 полугодие – 7 семестр  
**Группа:** ПИЖ-б-о-22-1  
**Дисциплина:** Администрирование баз данных  
**Студент:** Джараян Арег Александрович
## Теоретическая часть (краткое содержание):
**Физическая репликация: Точное бинарное копирование данных основного сервера (мастера)
на один или несколько ведомых серверов (реплик). Обеспечивает высокую доступность и
отказоустойчивость.**
**Логическая репликация: Репликация на уровне таблиц. Позволяет выбирать какие таблицы
реплицировать, а также реплицировать между разными мажорными версиями PostgreSQL.
Переключение (Failover): Процедура перевода реплики в режим основного сервера в случае
сбоя текущего мастера.**
**Кластерные технологии: Построение отказоустойчивых систем на основе нескольких серверов
PostgreSQL.**

### Модуль 1: Физическая репликация
**1. Базовая настройка: Настроил  физическую потоковую репликацию между двумя серверами (виртуально, на
разных портах или в разных каталогах) в синхронном режиме. Проверил работу репликации (вставка данных на мастере, проверка на реплике). Убедителся, что при остановленной реплике фиксация транзакций на мастере не завершается (в синхронном режиме).**
```sql
-- Создаем пользователя для репликации
CREATE USER areg WITH REPLICATION LOGIN PASSWORD 'areg';
```
```sql
-- Проверяем создание пользователя
\du areg
```
```sql
-- Настройка postgresql.conf
ALTER SYSTEM SET wal_level = replica;
```
```sql
ALTER SYSTEM SET max_wal_senders = 10;
```
```sql
ALTER SYSTEM SET max_replication_slots = 10;
```
```sql
ALTER SYSTEM SET synchronous_standby_names = 'replica1';
```
```sql
SELECT pg_reload_conf();
```
---фрагмет вывода
```text
CREATE ROLE
Time: 0.005s
```
```text
Role name  |                         Attributes                         
------------+------------------------------------------------------------
 areg | Replication
(1 row)

Time: 0.008s
```
```text
ALTER SYSTEM
Time: 0.004s
```
```text
ALTER SYSTEM
Time: 0.003s
```
```text
ALTER SYSTEM
Time: 0.003s
```
```text
pg_reload_conf 
----------------
 t
(1 row)

Time: 0.008s
```
**2. Конфликты применения: Изучил параметр max_standby_streaming_delay. По умолчанию конфликтующие запросы на реплике откладываются. Отключил откладывание применения (max_standby_streaming_delay = -1). Смоделировал ситуацию: запустите длительный запрос SELECT на реплике. На мастере
выполните VACUUM таблицы, участвующей в запросе. Убедителся, что запрос на реплике будет прерван. Включил на реплике обратную связь (hot_standby_feedback = on). Повторил эксперимент. Убедился, что теперь VACUUM на мастере откладывается и запрос на реплике не прерывается.**




**3. Слоты репликации: Остановил реплику. Убедился, что слот репликации на мастере препятствует удалению еще не переданных WAL-сегментов (проверьте через pg_replication_slots). Удалил слот репликации. Убедился, что очистка (vacuum) на мастере возобновилась.**

